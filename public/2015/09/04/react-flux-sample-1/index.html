<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>react flux 入门教程 | BOOMYA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="react flux 入门实例-todo">
<meta property="og:type" content="article">
<meta property="og:title" content="react flux 入门教程">
<meta property="og:url" content="http://boomya.github.io/2015/09/04/react-flux-sample-1/">
<meta property="og:site_name" content="BOOMYA">
<meta property="og:description" content="react flux 入门实例-todo">
<meta property="og:image" content="http://hulufei.gitbooks.io/react-tutorial/content/image/flux-overview.png">
<meta property="og:image" content="https://dn-linx4200.qbox.me/img/2015/01/complex-Flux-data-flow.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="react flux 入门教程">
<meta name="twitter:description" content="react flux 入门实例-todo">

  
    <link rel="alternative" href="/atom.xml" title="BOOMYA" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">

  <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">

  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">BOOMYA</a>
    <div class="collapse navbar-collapse nav-menu">
      <ul class="nav navbar-nav">
      
        <li>
          <a href="/archives">
            <i class="fa fa-archive"></i>
            Archives
          </a>
        </li>
      
        <li>
          <a href="/categories">
            <i class="fa fa-folder"></i>
            Categories
          </a>
        </li>
      
        <li>
          <a href="/tags">
            <i class="fa fa-tags"></i>
            Tags
          </a>
        </li>
      
        <li>
          <a href="/wiki">
            <i class="fa fa-book"></i>
            Wiki
          </a>
        </li>
      
        <li>
          <a href="/about">
            <i class="fa fa-user"></i>
            About
          </a>
        </li>
      
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
          <li><a id="rss-link" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>

      <div id='content' class="container">

        <div class="page-header-wrapper">
          <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
          <div class="page-header">
            <h1 class="title">
          
            react flux 入门教程
          
            </h1>
        </div>
      </div>
      
      <section id="main"
        
      ><article id="post-upihfo24l73xd93d" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="toc"><span class="toc-header">Contents</span><ol class="article-toc"><li class="article-toc-item article-toc-level-4"><a class="article-toc-link" href="#什么是flux"><span class="article-toc-text">什么是flux</span></a><ol class="article-toc-child"><li class="article-toc-item article-toc-level-5"><a class="article-toc-link" href="#<em>flux</em>-应用的四个部分"><span class="article-toc-text">flux 应用的四个部分</span></a></li><li class="article-toc-item article-toc-level-5"><a class="article-toc-link" href="#单向数据流"><span class="article-toc-text">单向数据流</span></a></li></ol></li><li class="article-toc-item article-toc-level-4"><a class="article-toc-link" href="#flux核心概念"><span class="article-toc-text">flux核心概念</span></a><ol class="article-toc-child"><li class="article-toc-item article-toc-level-5"><a class="article-toc-link" href="#dispather"><span class="article-toc-text">dispather</span></a></li><li class="article-toc-item article-toc-level-5"><a class="article-toc-link" href="#stores"><span class="article-toc-text">stores</span></a></li><li class="article-toc-item article-toc-level-5"><a class="article-toc-link" href="#views"><span class="article-toc-text">views</span></a></li></ol></li><li class="article-toc-item article-toc-level-4"><a class="article-toc-link" href="#实例用到的三方库介绍"><span class="article-toc-text">实例用到的三方库介绍</span></a><ol class="article-toc-child"><li class="article-toc-item article-toc-level-5"><a class="article-toc-link" href="#keymirror"><span class="article-toc-text">keymirror</span></a></li><li class="article-toc-item article-toc-level-5"><a class="article-toc-link" href="#object-assign"><span class="article-toc-text">object-assign</span></a></li><li class="article-toc-item article-toc-level-5"><a class="article-toc-link" href="#eventemitter"><span class="article-toc-text">EventEmitter</span></a></li><li class="article-toc-item article-toc-level-5"><a class="article-toc-link" href="#classnames"><span class="article-toc-text">classnames</span></a></li></ol></li><li class="article-toc-item article-toc-level-4"><a class="article-toc-link" href="#运行实例"><span class="article-toc-text">运行实例</span></a></li></ol></div><p>react flux 入门实例-todo<br><a id="more"></a></p>
<h4 id="什么是flux">什么是flux</h4><p><em>flux</em> 是一个由<em>facebook</em>创造出来的术语,是<em>facebook</em> 使用的一套前端应用的架构模式. 用来描述单向的数据流的设计模型. 这里的<em>flux</em>不是指一定要使用<em>flux</em>库, 不过的确需要<em>flux dispathcer</em>以及事件库.   </p>
<h5 id="<em>flux</em>-应用的四个部分"><em>flux</em> 应用的四个部分</h5><ul>
<li><em>the dispatcher</em><br>处理动作分发，维护 <em>store</em> 之间的依赖关系</li>
<li><em>the stores</em><br>数据和逻辑部分</li>
<li><em>the views</em><br><em>react</em> 组件，这一层可以看作 <em>controller-views</em>，作为视图同时响应用户交互</li>
<li><em>the actions</em><br>提供给 <em>dispatcher</em> 传递数据给 <em>store</em></li>
</ul>
<h5 id="单向数据流">单向数据流</h5><p><img src="http://hulufei.gitbooks.io/react-tutorial/content/image/flux-overview.png" alt="flux">
整个流程如下：</p>
<ul>
<li>首先要有 <em>action</em>，通过定义一些 <em>action creator</em> 方法根据需要创建 <em>Action</em> 提供给 <em>dispatcher</em></li>
<li><em>View</em> 层通过用户交互会触发 <em>Action</em></li>
<li><em>Dispatcher</em> 会分发触发的 <em>Action</em> 给所有注册的 <em>Store</em> 的回调函数</li>
<li><em>Store</em> 回调函数根据接收的 <em>Action</em> 更新自身数据之后会触发一个 <em>change</em> 事件通知 <em>View</em> 数据更改了</li>
<li><em>View</em> 会监听这个 <em>change</em> 事件，拿到对应的新数据并调用 <em>setState</em> 更新组件 UI  </li>
</ul>
<p>所有的状态都由 <em>Store</em> 来维护，通过 <em>Action</em> 传递数据，构成了如上所述的单向数据流循环，所以应用中的各部分分工就相当明确，高度解耦了。<br>这种单向数据流使得整个系统都是透明可预测的。</p>
<h4 id="flux核心概念">flux核心概念</h4><h5 id="dispather">dispather</h5><p>一个应用只需要一个 <em>dispatcher</em> 作为分发中心，管理所有数据流向，分发动作给 <em>store</em>，没有太多其他的逻辑.<br><em>dispatcher</em> 分发动作给 <em>store</em> 注册的回调函数，这和一般的订阅/发布模式不同的地方在于：</p>
<ul>
<li>回调函数不是订阅到某一个特定的事件/频道，每个动作会分发给所有注册的回调函数</li>
<li>回调函数可以指定在其他回调之后调用</li>
</ul>
<p><em>dispatcher.js</em>提供的 API 很简单：  </p>
<ul>
<li><em>register(function callback): string</em><br>注册回调函数，返回一个 <em>token</em> 供在<em>waitFor()</em> 使用</li>
<li><em>unregister(string id): void</em><br>通过 <em>token</em> 移除回调</li>
<li><em>waitFor(array ids): void</em><br>在指定的回调函数执行之后才执行当前回调。这个方法只能在分发动作的回调函数中使用</li>
<li><em>dispatch(object payload): void</em><br>分发动作 <em>payload</em> 给所有注册回调</li>
<li><em>isDispatching(): boolean</em><br>返回 <em>dispatcher</em> 当前是否处在分发的状态</li>
</ul>
<h5 id="stores">stores</h5><p><em>stores</em> 包含应用的状态和逻辑. <em>stores</em> 管理着数据，接收数据的方法和 <em>dispatcher</em> 的回调函数。<br><em>store</em>在<em>dispatcher</em>注册(<em>AppDispatcher.register</em>)并提供<em>dispatcher</em>一个回调函数, 这个回调函数接受<em>action</em>作为参数. 在<em>store</em>的已注册的回调函数内, 有一个<em>switch</em>声明, 根据<em>action type</em>来提供进入不同<em>store</em>内部函数的钩子. 这允许了一个<em>action</em>可以通过<em>dispatcher</em>来更新<em>store</em>中的<em>state</em>. 待<em>state</em>更新后, <em>store</em>广播一个事件来告诉大家<em>state</em>已经更新啦, 然后<em>views</em>就可以获取新的<em>state</em>并更新自己.  </p>
<ul>
<li>一个 <em>store</em> 除了包含一個数据模型，还包含获取和更新数据的方法。</li>
<li><em>store</em> 在程序中是唯一知道該如何更新数据的角色。</li>
<li>一个 <em>store</em> 只负责处理单一需求。例如如果有其他部分需要关天图片的数据就应该再创建一个 <em>store</em> 并叫做<em>ImageStore</em>。</li>
<li><em>store</em> 里面不会暴露直接操作数据的方法给外部，暴露给外部调用的方法都是 <em>getter</em> 方法，没有 <em>setter</em> 方法，唯一更新数据的手段就是通过在 <em>dispatcher</em> 注册的回调函数。</li>
</ul>
<h5 id="views">views</h5><p><em>view</em> 就是 <em>react</em> 组件，从 <em>store</em> 获取状态（数据），绑定 <em>change</em> 事件处理。
大型的系统中应用<em>flux</em>的情况
<img src="https://dn-linx4200.qbox.me/img/2015/01/complex-Flux-data-flow.jpg" alt="flux"></p>
<h4 id="实例用到的三方库介绍">实例用到的三方库介绍</h4><h5 id="keymirror">keymirror</h5><p>JS的仿enum的函数库<br>输入:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> keyMirror = <span class="built_in">require</span>(<span class="string">'react/lib/keyMirror'</span>);</div><div class="line"><span class="built_in">module</span>.exports = keyMirror({</div><div class="line">  LOAD_SHOES: <span class="literal">null</span></div><div class="line">});</div></pre></td></tr></table></figure>

<p>输出:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">{ LOAD_SHOES: <span class="string">'LOAD_SHOES'</span> }</div></pre></td></tr></table></figure>

<p>映射key, 值就等于key</p>
<h5 id="object-assign">object-assign</h5><p>合并对象.   </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//格式</span></div><div class="line">objectAssign(target, source, [source, ...])</div></pre></td></tr></table></figure>

<p>如果source中的key重复, 后面的会把前面的覆盖掉.</p>
<h5 id="eventemitter">EventEmitter</h5><p>事件触发器.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">emitter.on(event, listener) <span class="comment">//向指定的事件监听器数组尾部添加一个新监听器。</span></div><div class="line">emitter.removeListener(event, listener) <span class="comment">//从指定监听器数组中删除一个监听器。需要注意的是，此操作将会改变处于被删监听器之后的那些监听器的索引。</span></div><div class="line">emitter.emit(event, [arg1], [arg2], [...]) <span class="comment">//使用所提供的参数，依次执行事件监听器数组中的每一个监听函数。</span></div></pre></td></tr></table></figure>

<h5 id="classnames">classnames</h5><p>将className组合起来.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">classNames({foo:<span class="literal">true</span>}, {bar:<span class="literal">false</span>}, {duck:<span class="literal">true</span>}); <span class="comment">//=&gt;'foo duck'</span></div></pre></td></tr></table></figure>

<h4 id="运行实例">运行实例</h4><p><a href="https://github.com/boomya/react/tree/master/flux-todo" target="_blank" rel="external">todo source</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">npm <span class="operator"><span class="keyword">install</span> -g gulp</span></div><div class="line">npm <span class="keyword">install</span> </div><div class="line">gulp serve</div></pre></td></tr></table></figure>

<p>访问 <a href="http://localhost:5000/" target="_blank" rel="external">http://localhost:5000/</a></p>

      
    </div>
  </div>
</article>


</section>
        
          
<aside id="sidebar">
  
    
      
<div class="widget-wrap center">
  <ul class="pagination">
    <li>
      
        <span class="nav-prev disabled">Prev</span>
      
    </li>
    <li>
      <a data-url="http://boomya.github.io/2015/09/04/react-flux-sample-1/" data-id="upihfo24l73xd93d" data_title="react flux 入门教程"
        data_summary="react flux 入门实例-todo
什么是fluxflux 是一个由facebook创造出来的术语,是facebook 使用的一套前端应用的架构模式. 用来描述单向的数据流的设计模型. 这里的flux不是指..." class="article-share-link">Share</a>
    </li>
    <li>
      
        <a href="/2015/08/28/react-sample-1/" class="nav-next">Next</a>
      
    </li>
  </ul>
</div>


    
      <div class="widget-wrap">
  <div class="post-widget">
    <i class="fa fa-clock-o"></i>
    <time datetime="2015-09-04T12:55:29.000Z" itemprop="datePublished">Sep 4 2015</time>
  </div>
</div>

    
      
  <div class="widget-wrap">
    <div class="post-widget">
      <i class="fa fa-folder"></i>
      <a class="category-link" href="/categories/react/">react<span class="category-count">5</span></a>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="post-widget">
      <i class="fa fa-tags"></i>
      <a class="tag-link" href="/tags/flux/">flux<span class="tag-count">1</span></a><a class="tag-link" href="/tags/javascript/">javascript<span class="tag-count">5</span></a><a class="tag-link" href="/tags/react/">react<span class="tag-count">5</span></a><a class="tag-link" href="/tags/前端/">前端<span class="tag-count">5</span></a>
    </div>
  </div>


    
  
</aside>


        
      </div>
      <footer id="footer">
  
  <div class="outer container">
    <div id="footer-info" class="inner">
      <a href="/">BOOMYA</a> &copy; 2015 Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/seff/nut" target="_blank">Nut</a>
    </div>
  </div>
</footer>
<a id="gotop" href="#">
  <i class="fa fa-chevron-up"></i>
</a>

    </div>
    <nav id="mobile-nav">
  
    <a href="[object Object]" class="mobile-nav-link">0</a>
  
    <a href="[object Object]" class="mobile-nav-link">1</a>
  
    <a href="[object Object]" class="mobile-nav-link">2</a>
  
    <a href="[object Object]" class="mobile-nav-link">3</a>
  
    <a href="[object Object]" class="mobile-nav-link">4</a>
  
</nav>

    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67214391-1', 'auto');
  ga('send', 'pageview');

</script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script src="/js/jquery.fitvids.js" type="text/javascript"></script>

<script src="/js/bootstrap.min.js" type="text/javascript"></script>

<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>
